<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>æˆå‘˜å‡½æ•°çš„é€‚é…å™¨äºç©ºé—´é…ç½®å™¨ | The Yue</title><noscript>å¼€å¯JavaScriptæ‰èƒ½è®¿é—®æœ¬ç«™å“¦~</noscript><link rel="icon" href="/huyue.github.io/img/avatar.png"><!-- index.css--><link rel="stylesheet" href="/huyue.github.io/css/index.css?v=1.8.6"><!-- inject head--><link rel="stylesheet" href="https://cdn2.codesign.qq.com/icons/7pOrz0WXB5ZWJPX/latest/iconfont.css"><!-- aplayer--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css"><!-- swiper--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.css"><!-- fancybox ui--><!-- katex--><!-- Open Graph--><meta name="description" content="æˆå‘˜å‡½æ•°çš„é€‚é…å™¨mem_fnç®—æ³•åº“é‡Œé¢çš„for_eachä¸æˆå‘˜å‡½æ•°å¹¶ä¸é€‚é…ï¼Œæ‰€ä»¥è¦ä½¿ç”¨mem_fnæ¥è·Ÿfor_eachç¬¬ä¸‰ä¸ªå‚æ•°é€‚é…ä¸€ä¸‹ 12345678910111213141516171819202122232425class Number&amp;#123;public: void print("><!-- pwa--><meta name="apple-mobile-web-app-capable" content="The Yue"><meta name="theme-color" content="var(--efu-main)"><meta name="apple-mobile-web-app-status-bar-style" content="var(--efu-main)"><link rel="bookmark" href="/huyue.github.io/img/avatar.png"><link rel="apple-touch-icon" href="/huyue.github.io/img/avatar.png" sizes="180x180"><script>console.log(
    "%c Program: Hexo %c Theme: Solitude %c Version: v1.8.6",
    "border-radius:5px 0 0 5px;padding: 5px 10px;color:white;background:#ff3842;",
    "padding: 5px 10px;color:white;background:#3e9f50;",
    "border-radius:0 5px 5px 0;padding: 5px 10px;background:#0084ff;color:white;"
);
</script><script>(()=>{
        const saveToLocal = {
            set: function setWithExpiry(key, value, ttl) {
                if (ttl === 0)
                    return
                const now = new Date()
                const expiryDay = ttl * 86400000
                const item = {
                    value: value,
                    expiry: now.getTime() + expiryDay
                }
                localStorage.setItem(key, JSON.stringify(item))
            },
            get: function getWithExpiry(key) {
                const itemStr = localStorage.getItem(key)
    
                if (!itemStr) {
                    return undefined
                }
                const item = JSON.parse(itemStr)
                const now = new Date()
    
                if (now.getTime() > item.expiry) {
                    localStorage.removeItem(key)
                    return undefined
                }
                return item.value
            }
        };
        window.utils = {
            saveToLocal: saveToLocal,
            getCSS: (url, id = false) => new Promise((resolve, reject) => {
              const link = document.createElement('link')
              link.rel = 'stylesheet'
              link.href = url
              if (id) link.id = id
              link.onerror = reject
              link.onload = link.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                link.onload = link.onreadystatechange = null
                resolve()
              }
              document.head.appendChild(link)
            }),
            getScript: (url, attr = {}) => new Promise((resolve, reject) => {
              const script = document.createElement('script')
              script.src = url
              script.async = true
              script.onerror = reject
              script.onload = script.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                script.onload = script.onreadystatechange = null
                resolve()
              }
    
              Object.keys(attr).forEach(key => {
                script.setAttribute(key, attr[key])
              })
    
              document.head.appendChild(script)
            }),
            addGlobalFn: (key, fn, name = false, parent = window) => {
                const globalFn = parent.globalFn || {}
                const keyObj = globalFn[key] || {}
        
                if (name && keyObj[name]) return
        
                name = name || Object.keys(keyObj).length
                keyObj[name] = fn
                globalFn[key] = keyObj
                parent.globalFn = globalFn
            },
        }
    })()</script><!-- global head--><script>const GLOBAL_CONFIG = {
    root: '/huyue.github.io/',
    algolia: undefined,
    localsearch: undefined,
    runtime: '2024-04-16 00:00:00',
    lazyload: {
        enable: true,
        error: '/img/error_load.png'
    },
    copyright: {"limit":50,"author":"ä½œè€…: èƒ¡è¶Š","link":"é“¾æ¥: ","source":"æ¥æº: The Yue","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚ å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"},
    highlight: {
        enable: true,
        limit: 200,
        expand: true,
        copy: true,
        syntax: 'highlight.js'
    },
    randomlink: false,
    lang: {"theme":{"dark":"å·²åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼","light":"å·²åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼"},"copy":{"success":"å¤åˆ¶æˆåŠŸ","error":"å¤åˆ¶å¤±è´¥"},"backtop":"è¿”å›é¡¶éƒ¨","time":{"day":"å¤©å‰","hour":"å°æ—¶å‰","just":"åˆšåˆš","min":"åˆ†é’Ÿå‰","month":"ä¸ªæœˆå‰"},"f12":"å¼€å‘è€…æ¨¡å¼å·²æ‰“å¼€ï¼Œè¯·éµå¾ªGPLåè®®ã€‚","totalk":"æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¾“å…¥è¯„è®ºå³å¯"},
    aside: {
        sayhello: {
            morning: 'ä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨',
            noon: 'åƒé¥±äº†æ‰æœ‰åŠ›æ°”å¹²æ´»',
            afternoon: 'é›†ä¸­ç²¾åŠ›ï¼Œæ”»å…‹éš¾å…³',
            night: 'ä¸è¦å¤ªåŠ³ç´¯äº†ï¼Œæ—©ç¡æ›´å¥åº·',
            goodnight: 'ç¡ä¸ªå¥½è§‰ï¼Œä¿è¯ç²¾åŠ›å……æ²›',
        },
        sayhello2: ["ğŸ® ç”µç«æ¸¸æˆçˆ±å¥½è€…"],
    },
    covercolor: {
        enable: false
    },
    comment: false,
    lightbox: 'null',
    post_ai: false,
    right_menu: false,
};</script><!-- page-config head--><script id="config-diff">var PAGE_CONFIG = {
    is_post: true,
    is_page: false,
    is_home: false,
    page: '',
    toc: true,
    comment: false,
    ai_text: false,
}</script><meta name="generator" content="Hexo 7.1.1"></head><body id="body"><!-- universe--><canvas id="universe"></canvas><!-- loading--><div id="loading-box" onclick="preloader.endLoading();" style="zoom:1"><div class="loading-bg"><img class="loading-img nolazyload" src="https://api.qjqq.cn/api/MiYouShe" alt="loading image"></div></div><script>const preloader = {
    endLoading: () => {
        document.getElementById('loading-box').classList.toggle('loaded');
    },
    initLoading: () => {
        document.getElementById('loading-box').classList.remove('loaded');
    },
    removePaceDone: () => {
        document.getElementById('body').classList = 'pace-done';
    }
}
window.addEventListener('load', () => {
    preloader.endLoading();
});
window.addEventListener('pjax:send', () => {
    preloader.initLoading();
});
document.addEventListener('pjax:complete', () => {
    preloader.endLoading();
});</script><!-- console--><div id="console"><div class="close-btn" onclick="sco.hideConsole()"><i class="solitude st-close-fill"></i></div><div class="button-group"><div class="console-btn-item"><span class="darkmode_switchbutton" onclick="sco.switchDarkMode()" title="æ˜¼å¤œåˆ‡æ¢"><i class="solitude st-moon-clear-fill"></i></span></div><div class="console-btn-item" id="consoleHideAside"><span class="asideSwitch" onclick="sco.switchHideAside()" title="è¾¹æ æ˜¾ç¤ºæ§åˆ¶"><i class="solitude st-side-bar-fill"></i></span></div><div class="console-btn-item" id="consoleMusic" onclick="sco.musicToggle()"><span class="music-switch" title="éŸ³ä¹å¼€å…³"><i class="solitude st-disc-fill"></i></span></div></div><div class="console-mask" onclick="sco.hideConsole()"></div></div><!-- sidebar--><div id="sidebar" style="zoom: 1;"><div id="menu-mask" style="display: none;"></div><div id="sidebar-menus"><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/huyue.github.io/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">52</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/huyue.github.io/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/huyue.github.io/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">8</div></a></div></div></div><span class="sidebar-menu-item-title">åŠŸèƒ½</span><div class="sidebar-menu-item"><span class="darkmode_switchbutton menu-child" onclick="sco.switchDarkMode()"><i class="solitude st-moon-clear-fill"></i><span>æ˜¾ç¤ºæ¨¡å¼</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/huyue.github.io/"><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>æ–‡åº“</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/archives/"><i class="solitude  st-folder-fill"></i><span>æ–‡ç« åˆ—è¡¨</span></a></li><li><a class="site-page child" href="/huyue.github.io/categories/"><i class="solitude  st-checkbox-multiple-blank-fill"></i><span>å…¨éƒ¨åˆ†ç±»</span></a></li><li><a class="site-page child" href="/huyue.github.io/tags/"><i class="solitude  st-price-tag-fill"></i><span>å…¨éƒ¨æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/moments/"><i class="solitude  st-wifi-fill"></i><span>å‹é“¾é±¼å¡˜</span></a></li><li><a class="site-page child" href="/huyue.github.io/links/"><i class="solitude  st-group-fill"></i><span>å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="javascript:travelling()"><i class="solitude  st-gift-fill"></i><span>å®è—åšä¸»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>åˆ†äº«</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/equipment/"><i class="solitude  st-laptop-line"></i><span>è£…å¤‡</span></a></li><li><a class="site-page child" href="/huyue.github.io/tlink/"><i class="solitude  st-tools-fill"></i><span>å·¥å…·ç®±</span></a></li><li><a class="site-page child" href="/huyue.github.io/music/"><i class="solitude  st-disc-fill"></i><span>éŸ³ä¹é¦†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/about/"><i class="solitude  st-contacts-fill"></i><span>å…³äºæœ¬ç«™</span></a></li></ul></div></div><span class="sidebar-menu-item-title">æ ‡ç­¾</span><div class="card-widget card-tags card-archives card-webinfo card-allinfo"><div class="card-tag-cloud"><a href="/huyue.github.io/tags/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®<sup>1</sup></a><a href="/huyue.github.io/tags/%E6%89%8B%E5%86%8C/">æ‰‹å†Œ<sup>29</sup></a><a href="/huyue.github.io/tags/%E6%95%99%E7%A8%8B/">æ•™ç¨‹<sup>1</sup></a><a href="/huyue.github.io/tags/%E7%AC%94%E8%AE%B0/">ç¬”è®°<sup>16</sup></a><a href="/huyue.github.io/tags/%E7%AE%97%E6%B3%95/">ç®—æ³•<sup>2</sup></a><a href="/huyue.github.io/tags/%E5%88%86%E4%BA%AB/">åˆ†äº«<sup>1</sup></a><a href="/huyue.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼<sup>1</sup></a><a href="/huyue.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„<sup>1</sup></a></div></div></div></div><!-- keyboard--><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav class="show" id="nav"><div id="nav-group"><div id="blog_name"><a id="site-name" href="/huyue.github.io/" title="è¿”å›åšå®¢ä¸»é¡µ"><span class="title">è¶Šã®åšå®¢</span></a></div><div id="page-name-mask"><div id="page-name"><a id="page-name-text" onclick="sco.toTop()">æˆå‘˜å‡½æ•°çš„é€‚é…å™¨äºç©ºé—´é…ç½®å™¨</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/huyue.github.io/"><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>æ–‡åº“</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/archives/"><i class="solitude  st-folder-fill"></i><span>æ–‡ç« åˆ—è¡¨</span></a></li><li><a class="site-page child" href="/huyue.github.io/categories/"><i class="solitude  st-checkbox-multiple-blank-fill"></i><span>å…¨éƒ¨åˆ†ç±»</span></a></li><li><a class="site-page child" href="/huyue.github.io/tags/"><i class="solitude  st-price-tag-fill"></i><span>å…¨éƒ¨æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>å‹é“¾</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/moments/"><i class="solitude  st-wifi-fill"></i><span>å‹é“¾é±¼å¡˜</span></a></li><li><a class="site-page child" href="/huyue.github.io/links/"><i class="solitude  st-group-fill"></i><span>å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="javascript:travelling()"><i class="solitude  st-gift-fill"></i><span>å®è—åšä¸»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>åˆ†äº«</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/equipment/"><i class="solitude  st-laptop-line"></i><span>è£…å¤‡</span></a></li><li><a class="site-page child" href="/huyue.github.io/tlink/"><i class="solitude  st-tools-fill"></i><span>å·¥å…·ç®±</span></a></li><li><a class="site-page child" href="/huyue.github.io/music/"><i class="solitude  st-disc-fill"></i><span>éŸ³ä¹é¦†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span>å…³äº</span></a><ul class="menus_item_child"><li><a class="site-page child" href="/huyue.github.io/about/"><i class="solitude  st-contacts-fill"></i><span>å…³äºæœ¬ç«™</span></a></li></ul></div></div></div><div id="nav-left"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºä¸€ç¯‡æ–‡ç« " href="javascript:void(0);"><i class="solitude st-signal-tower-fill"></i></a></div><div class="nav-button" id="nav-console"><a class="console_switchbutton" onclick="sco.showConsole()" title="ä¸­æ§å°" href="javascript:void(0);"><i class="solitude st-dashboard-fill"></i></a></div><div class="nav-button" id="nav-totop" onclick="sco.toTop()"><a class="totopbtn"><i class="solitude st-arrow-up-line"></i><span id="percent">0</span></a></div><div id="toggle-menu"><a class="site-page"><i class="solitude st-menu-line"></i></a></div></div></div></nav><div class="coverdiv" id="coverdiv"><img class="nolazyload" id="post-cover" src="https://api.qjqq.cn/api/Img?sort=acg&amp;random=84" alt="æˆå‘˜å‡½æ•°çš„é€‚é…å™¨äºç©ºé—´é…ç½®å™¨"></div><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®">åŸåˆ›</a><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/huyue.github.io/tags/%E7%AC%94%E8%AE%B0/"><span class="tags-name tags-punctuation">ç¬”è®°</span></a></div></div></div></div><h1 class="post-title">æˆå‘˜å‡½æ•°çš„é€‚é…å™¨äºç©ºé—´é…ç½®å™¨</h1><div id="post-meta"><div class="meta-secondline"><span class="post-meta-date" title="å‘å¸ƒäº 2024-07-01 21:49:00"><i class="post-meta-icon solitude st-calendar-todo-fill"></i><time datetime="2024-07-01T13:49:00.000Z">2024-07-01T13:49:00.000Z</time></span><span class="post-meta-date" title="æœ€åæ›´æ–°äº 2024-07-01 21:49:31"><i class="post-meta-icon solitude st-refresh-line"></i><time datetime="2024-07-01T13:49:31.594Z">2024-07-01T13:49:31.594Z</time></span><span class="post-meta-position" title="ä½œè€…IPå½’å±åœ°ä¸ºæ­¦æ±‰"><i class="post-meta-icon solitude st-map-pin-fill"></i><span>æ­¦æ±‰</span></span><a class="post-meta-pv" href="/huyue.github.io/2024/07/01/2024-7-1-%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%82%E9%85%8D%E5%99%A8%E4%BA%8E%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8/" title="æ–‡ç« çƒ­åº¦"><i class="post-meta-icon solitude st-fire-fill"></i><span id="busuanzi_value_page_pv"><i class="solitude st-loading-line"></i></span></a></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="æˆå‘˜å‡½æ•°çš„é€‚é…å™¨"><a href="#æˆå‘˜å‡½æ•°çš„é€‚é…å™¨" class="headerlink" title="æˆå‘˜å‡½æ•°çš„é€‚é…å™¨"></a>æˆå‘˜å‡½æ•°çš„é€‚é…å™¨</h1><h2 id="mem-fn"><a href="#mem-fn" class="headerlink" title="mem_fn"></a>mem_fn</h2><p>ç®—æ³•åº“é‡Œé¢çš„for_eachä¸æˆå‘˜å‡½æ•°å¹¶ä¸é€‚é…ï¼Œæ‰€ä»¥è¦ä½¿ç”¨mem_fnæ¥è·Ÿfor_eachç¬¬ä¸‰ä¸ªå‚æ•°é€‚é…ä¸€ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªå¶æ•°</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEven</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vector&lt;Number&gt; vec;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; ++i)&#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(<span class="built_in">Number</span>(i));</span><br><span class="line">    &#125;</span><br><span class="line">    for_each(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>(),<span class="built_in">mem_fn</span>(&amp;Number::print));<span class="comment">//ä¸è¿™ä¹ˆå†™ä¼šæŠ¥é”™</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ é™¤æ‰€æœ‰çš„å¶æ•°</span></span><br><span class="line">    <span class="built_in">remove_if</span>(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>(),<span class="built_in">mem_fn</span>(&amp;Number::isEven));<span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°è¦æ±‚ä¸€ä¸ªä¸€å…ƒæ–­è¨€</span></span><br><span class="line">    <span class="comment">//è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆç¬¦åˆæ¡ä»¶çš„è¿­ä»£å™¨ï¼‰,å›å¿†ä¸€ä¸‹</span></span><br><span class="line">    <span class="comment">//è¦åˆ é™¤è¦é…åˆerase</span></span><br><span class="line">    vec,<span class="built_in">erase</span>((<span class="built_in">remove_if</span>(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>(),<span class="built_in">mem_fn</span>(&amp;Number::isEven))),vec.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ç”¨mem_fnæ¥é€‚é…ï¼Œç”¨bindæ˜¯å¦ä¹Ÿå¯ä»¥é€‚é…å‘¢</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    vector&lt;Number&gt; vec;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; ++i)&#123;</span><br><span class="line">        vec.<span class="built_in">push_back</span>(<span class="built_in">Number</span>(i));</span><br><span class="line">    &#125;</span><br><span class="line">    for_each(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>(),<span class="built_in">bind</span>(&amp;Number::print,_1));<span class="comment">//bindç»‘å®šçš„å‚æ•°ä¸èƒ½ä½¿ç”¨å›ºå®šçš„å¯¹è±¡ï¼Œä¸ç„¶æŒ‰æˆ‘çš„ç†è§£ï¼Œæ¯æ¬¡éƒ½æ˜¯è°ƒç”¨çš„è¯¥å¯¹è±¡çš„ print,é‚£ä¸èƒ½ç”¨å›ºå®šçš„å¯¹è±¡ï¼Œé‚£thisæŒ‡é’ˆè¿™ä¸ªå‚æ•°åº”è¯¥å¡«ä»€ä¹ˆï¼Ÿ è¿˜æœ‰å ä½ç¬¦ï¼Œè¿™æ ·å°±å¯ä»¥æ¯æ¬¡éƒ½ä¼ é€’çš„æ˜¯vecé‡Œé¢çš„å¯¹è±¡äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>for_eachç¬¬ä¸‰ä¸ªå‚æ•°ç»‘å®šçš„æ˜¯ä¸€å…ƒæ–­è¨€ï¼Œä½†æ˜¯ä½¿ç”¨bindç»‘å®šåæ”¹å˜å‡½æ•°å½¢æ€å˜æˆæ— å‚å‡½æ•°ï¼Œå…¶å®æ˜¯ç›¸å½“äºç»™å‚æ•°æä¾›äº†ä¸€ä¸ªé»˜è®¤å€¼</p>
<h1 id="å‡½æ•°å¯¹è±¡"><a href="#å‡½æ•°å¯¹è±¡" class="headerlink" title="å‡½æ•°å¯¹è±¡"></a>å‡½æ•°å¯¹è±¡</h1><p>æ‰€æœ‰å¯ä»¥ä¸()è¿›è¡Œç»“åˆï¼Œä½“ç°å‡½æ•°å®šä¹‰çš„éƒ½ç§°ä¸ºå‡½æ•°å¯¹è±¡ã€‚</p>
<p>1ï¼Œé‡è½½äº†å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦(operator())çš„ç±»åˆ›å»ºçš„å¯¹è±¡</p>
<p>2ï¼Œå‡½æ•°å</p>
<p>3ï¼Œå‡½æ•°æŒ‡é’ˆ</p>
<h1 id="ç©ºé—´é…ç½®å™¨ï¼ˆ-é‡è¦-ï¼‰"><a href="#ç©ºé—´é…ç½®å™¨ï¼ˆ-é‡è¦-ï¼‰" class="headerlink" title="ç©ºé—´é…ç½®å™¨ï¼ˆ&#x3D;&#x3D;é‡è¦&#x3D;&#x3D;ï¼‰"></a>ç©ºé—´é…ç½®å™¨ï¼ˆ&#x3D;&#x3D;é‡è¦&#x3D;&#x3D;ï¼‰</h1><p><strong>ä¸ºä»€ä¹ˆè¦æŠŠç©ºé—´çš„ç”³è¯·å’Œå¯¹è±¡çš„æ„å»ºåˆ†å¼€å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºåœ¨STLä¸­ï¼Œéœ€è¦çš„å¯¹è±¡æ˜¯æ‰¹é‡çš„ï¼Œå¦‚æœæŠŠç”³è¯·ç©ºé—´å’Œæ„å»ºå¯¹è±¡ä¸¤ä¸ªæ“ä½œé»åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæ¯æ¬¡æœ‰ä¸€ä¸ªæ–°å¯¹è±¡å°±è¦ç”³è¯·ä¸€æ¬¡ç©ºé—´ï¼Œè€Œä¸”ï¼Œæ¯æ¬¡ç”³è¯·çš„ç©ºé—´å¯èƒ½éƒ½ä¸æ˜¯è¿ç»­çš„ï¼Œè¿™æ ·ä¼šé€ æˆå†…å­˜ç¢ç‰‡çš„é—®é¢˜æˆ–è€…æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥å°±å°†ç©ºé—´çš„ç”³è¯·å’Œå¯¹è±¡çš„æ„æ¶åˆ†å¼€ï¼Œå…ˆç”³è¯·çš„å¤§é‡çš„ç©ºé—´ï¼Œéœ€è¦å¯¹è±¡å°±åœ¨è¿™ç¯‡ç©ºé—´é‡Œæ„å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé¿å…äº†é¢‘ç¹çš„ç”³è¯·ç©ºé—´ï¼Œä¹Ÿæ²¡æœ‰å†…å­˜ç¢ç‰‡ã€‚</p>
<h2 id="å‡½æ•°æ¥å£"><a href="#å‡½æ•°æ¥å£" class="headerlink" title="å‡½æ•°æ¥å£"></a>å‡½æ•°æ¥å£</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”³è¯·ç©ºé—´</span></span><br><span class="line"><span class="function">T * <span class="title">allocate</span><span class="params">(std::<span class="type">size_t</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾ç©ºé—´</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">deallocate</span><span class="params">(T *p, std::<span class="type">size_t</span> n)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„å»ºå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">construct</span><span class="params">( pointer p, const_reference val )</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é”€æ¯å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">( pointer p )</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆè¦å…ˆé”€æ¯å¯¹è±¡å†å›æ”¶ç©ºé—´ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å›æ”¶ç©ºé—´å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºï¼Œç©ºé—´å†…å­˜çš„å¯¹è±¡å¾ˆæœ‰å¯èƒ½ä¹ŸæŒ‡å‘æŸä¸€ç‰‡å †ç©ºé—´ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡çš„ææ„å‡½æ•°å°±ä¸ä¼šæ‰§è¡Œï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œå…ˆé”€æ¯å¯¹è±¡å°±ä¼šè°ƒç”¨è¿™äº›å¯¹è±¡çš„ææ„å‡½æ•°ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ç©ºé—´é…ç½®å™¨åˆ†ä¸ºä¸¤çº§</p>
<ul>
<li>ä¸€çº§ç©ºé—´é…ç½®å™¨</li>
<li>äºŒçº§ç©ºé—´é…ç½®å™¨<ul>
<li>å¤§äº128å­—èŠ‚è°ƒç”¨ä¸€çº§ç©ºé—´é…ç½®å™¨</li>
<li>å°äº128å­—èŠ‚ä½¿ç”¨16ç»´è‡ªç”±é“¾è¡¨+å†…å­˜æ± </li>
</ul>
</li>
</ul>
<p>16ç»´è‡ªç”±é“¾è¡¨å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ¯ä¸ªç´¢å¼•ä¸‹é¢æŒ‚ä¸€ä¸ªé“¾è¡¨ï¼ˆç±»ä¼¼äºå“ˆå¸Œè¡¨çš„æ‹‰é“¾æ³•ï¼‰ï¼Œç´¢å¼•ä¸º0ï¼Œä¸‹é¢æŒ‚çš„å°±æ˜¯8å­—èŠ‚çš„è‡ªç”±é“¾è¡¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯8å­—èŠ‚ï¼‰ï¼Œç´¢å¼•ä¸º1ï¼Œä¸‹é¢æŒ‚çš„å°±æ˜¯16å­—èŠ‚çš„è‡ªç”±é“¾è¡¨ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸‹æ ‡ä¸º15æŒ‚çš„å°±æ˜¯128å­—èŠ‚çš„è‡ªç”±é“¾è¡¨ã€‚</p>
<p>[<img src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://s21.ax1x.com/2024/07/01/pkgVrb4.png" alt="pkgVrb4.png"></p>
<p>å¦‚æœè¦ç”³è¯·nä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œä¸”n&lt;128ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹nå‘ä¸Šå–æ•´ï¼Œä¾‹å¦‚æƒ³è¦ç”³è¯·30ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±ä¼šæ˜ å°„æ‰¾åˆ°ä¸‹æ ‡ä¸º3çš„ä½ç½®ï¼Œå¦‚æœè¯¥ç´¢å¼•ä¸‹é¢è¶³å¤Ÿåˆ†é…æ­¤32ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±åˆ†é…ï¼Œå¦‚æœä¸å¤Ÿï¼Œå°±ç›´æ¥ç”³è¯·20ä¸ª32å­—èŠ‚ï¼Œç„¶åç•™ä¸‹åˆ†é…ç»™æ­¤æ¬¡ç”³è¯·çš„ç©ºé—´ï¼Œç„¶åå°†å‰©ä¸‹çš„å…¨æŒ‚åœ¨è¯¥ç´¢å¼•ä¸‹é¢çš„ä½ç½®ä¸Šã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹è°ƒç”¨çš„æ˜¯äºŒçº§ç©ºé—´é…ç½®å™¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨16ç»´çš„è‡ªç”±é“¾è¡¨+å†…å­˜æ± ï¼Ÿ</p>
<p>æˆ‘ä»¬è®¤ä¸º128ä¸€ä¸‹å°±æ˜¯å°ç‰‡ç©ºé—´ï¼Œå¦‚æœé¢‘ç¹ç”³è¯·å°ç‰‡ç©ºé—´å¯èƒ½ä¼šå‡ºç°ä¸€ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>é¢‘ç¹ç”³è¯·å°ç‰‡ç©ºé—´çš„æ—¶å€™ï¼Œä¼šæœ‰å†…å­˜ç¢ç‰‡çš„é—®é¢˜</li>
<li>é¢‘ç¹çš„åœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œä¼šå¯¼è‡´æ•ˆç‡ä¸é«˜</li>
</ol>
<h2 id="æºç å‰–æ"><a href="#æºç å‰–æ" class="headerlink" title="æºç å‰–æ"></a>æºç å‰–æ</h2><h3 id="ç©ºé—´é…ç½®å™¨â€”â€”allocator"><a href="#ç©ºé—´é…ç½®å™¨â€”â€”allocator" class="headerlink" title="ç©ºé—´é…ç½®å™¨â€”â€”allocator"></a>ç©ºé—´é…ç½®å™¨â€”â€”allocator</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">allocator</span> &#123;</span><br><span class="line">  <span class="keyword">typedef</span> alloc _Alloc;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">_Tp* <span class="title">allocate</span><span class="params">(size_type __n, <span class="type">const</span> <span class="type">void</span>* = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> __n != <span class="number">0</span> ? <span class="built_in">static_cast</span>&lt;_Tp*&gt;(_Alloc::<span class="built_in">allocate</span>(__n * <span class="built_in">sizeof</span>(_Tp))) </span><br><span class="line">                    : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">deallocate</span><span class="params">(pointer __p, size_type __n)</span></span></span><br><span class="line"><span class="function">    </span>&#123; _Alloc::<span class="built_in">deallocate</span>(__p, __n * <span class="built_in">sizeof</span>(_Tp)); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">construct</span><span class="params">(pointer __p, <span class="type">const</span> _Tp&amp; __val)</span> </span>&#123; <span class="keyword">new</span>(__p) _Tp(__val); &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">(pointer __p)</span> </span>&#123; __p-&gt;~_Tp(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ‰å››ä¸ªå‡½æ•°allocate,deallocate,construct,destoryå¾ˆé‡è¦</p>
<p>è¿™å››ä¸ªå‡½æ•°å°±æ˜¯ä¸Šè¿°æåˆ°äº†å››ä¸ªå‡½æ•°æ¥å£</p>
<p>æ¥ä¸‹æ¥ä¸€ä¸ªä¸€ä¸ªåˆ†æ</p>
<h4 id="allocate"><a href="#allocate" class="headerlink" title="allocate"></a>allocate</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_Tp* <span class="title">allocate</span><span class="params">(size_type __n, <span class="type">const</span> <span class="type">void</span>* = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> __n != <span class="number">0</span> ? <span class="built_in">static_cast</span>&lt;_Tp*&gt;(_Alloc::<span class="built_in">allocate</span>(__n * <span class="built_in">sizeof</span>(_Tp))) </span><br><span class="line">                    : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿™ä¸ªå‡½æ•°å†…éƒ¨è°ƒç”¨äº†<code>_Alloc::allocate</code>,æ¥ä¸‹æ¥çœ‹çœ‹è¿™ä¸ªæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿</p>
<p>é¦–å…ˆ<code>_Alloc</code>çš„å®šä¹‰ä¸º</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> alloc _Alloc;  </span><br></pre></td></tr></table></figure>

<p>è¯´æ˜è°ƒç”¨äº†allocè¿™ä¸ªç±»çš„æˆå‘˜å‡½æ•°allocateåˆ†é…å†…å­˜ï¼Œå»æ‰¾åˆ°allocè¿™ä¸ªç±»çš„å®šä¹‰</p>
<p>åœ¨è¿™é‡Œå°±æ¶‰åŠåˆ°ä¸¤çº§ç©ºé—´é…ç½®å™¨äº†</p>
<h5 id="ä¸€çº§ç©ºé—´é…ç½®å™¨"><a href="#ä¸€çº§ç©ºé—´é…ç½®å™¨" class="headerlink" title="ä¸€çº§ç©ºé—´é…ç½®å™¨"></a>ä¸€çº§ç©ºé—´é…ç½®å™¨</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">ifdef</span> __USE_MALLOC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> malloc_alloc alloc;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†å®çš„è¯åˆ†é…å†…å­˜å°±ä¼šèµ°ä¸€çº§ç©ºé—´é…ç½®å™¨ï¼Œæ¥ä¸‹æ¥å°±è¦å»çœ‹çœ‹ä¸€çº§ç©ºé—´é…ç½®å™¨åˆ°åº•æ˜¯ä»€ä¹ˆåŸç†ï¼Œå»æ‰¾åˆ°malloc_allocçš„å®šä¹‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> __malloc_alloc_template&lt;<span class="number">0</span>&gt; malloc_alloc;</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰ä¸€ä¸ªåˆ«åï¼Œæ¥ç€æ‰¾</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">__malloc_alloc_template</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="title">allocate</span><span class="params">(<span class="type">size_t</span> __n)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="type">void</span>* __result = <span class="built_in">malloc</span>(__n);</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == __result) __result = _S_oom_malloc(__n);</span><br><span class="line">    <span class="keyword">return</span> __result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åªéœ€è¦å»çœ‹allocateçš„å®šä¹‰ï¼Œå‘ç°åº•å±‚å°±æ˜¯è°ƒç”¨äº†ä¸€ä¸ªmallocæ¥åˆ†é…å†…å­˜</p>
<h5 id="äºŒçº§ç©ºé—´é…ç½®å™¨"><a href="#äºŒçº§ç©ºé—´é…ç½®å™¨" class="headerlink" title="äºŒçº§ç©ºé—´é…ç½®å™¨"></a>äºŒçº§ç©ºé—´é…ç½®å™¨</h5><p>äºŒçº§ç©ºé—´é…ç½®å™¨å°±æ˜¯é»˜è®¤çš„åˆ†é…å†…å­˜çš„ç©ºé—´é…ç½®å™¨</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">__default_alloc_template</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ! (defined(__SUNPRO_CC) || defined(__GNUC__))</span></span><br><span class="line">    <span class="keyword">enum</span> &#123;_ALIGN = <span class="number">8</span>&#125;;</span><br><span class="line">    <span class="keyword">enum</span> &#123;_MAX_BYTES = <span class="number">128</span>&#125;;</span><br><span class="line">    <span class="keyword">enum</span> &#123;_NFREELISTS = <span class="number">16</span>&#125;; <span class="comment">// _MAX_BYTES/_ALIGN</span></span><br><span class="line"><span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line">  <span class="type">static</span> <span class="type">size_t</span></span><br><span class="line">  _S_round_up(<span class="type">size_t</span> __bytes) </span><br><span class="line">    &#123; <span class="keyword">return</span> (((__bytes) + (<span class="type">size_t</span>) _ALIGN<span class="number">-1</span>) &amp; ~((<span class="type">size_t</span>) _ALIGN - <span class="number">1</span>)); &#125;</span><br><span class="line"></span><br><span class="line">__PRIVATE:</span><br><span class="line">  <span class="keyword">union</span> <span class="title class_">_Obj</span> &#123;</span><br><span class="line">        <span class="keyword">union</span> <span class="title class_">_Obj</span>* _M_free_list_link;</span><br><span class="line">        <span class="type">char</span> _M_client_data[<span class="number">1</span>];    <span class="comment">/* The client sees this.        */</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> _Obj* __STL_VOLATILE _S_free_list[]; </span><br><span class="line"><span class="meta"># <span class="keyword">else</span></span></span><br><span class="line">    <span class="type">static</span> _Obj* __STL_VOLATILE _S_free_list[_NFREELISTS]; </span><br><span class="line"><span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line">  <span class="type">static</span>  <span class="type">size_t</span> _S_freelist_index(<span class="type">size_t</span> __bytes) &#123;</span><br><span class="line">        <span class="keyword">return</span> (((__bytes) + (<span class="type">size_t</span>)_ALIGN<span class="number">-1</span>)/(<span class="type">size_t</span>)_ALIGN - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Returns an object of size __n, and optionally adds to size __n free list.</span></span><br><span class="line">  <span class="type">static</span> <span class="type">void</span>* _S_refill(<span class="type">size_t</span> __n);</span><br><span class="line">  <span class="comment">// Allocates a chunk for nobjs of size size.  nobjs may be reduced</span></span><br><span class="line">  <span class="comment">// if it is inconvenient to allocate the requested number.</span></span><br><span class="line">  <span class="type">static</span> <span class="type">char</span>* _S_chunk_alloc(<span class="type">size_t</span> __size, <span class="type">int</span>&amp; __nobjs);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Chunk allocation state.</span></span><br><span class="line">  <span class="type">static</span> <span class="type">char</span>* _S_start_free;</span><br><span class="line">  <span class="type">static</span> <span class="type">char</span>* _S_end_free;</span><br><span class="line">  <span class="type">static</span> <span class="type">size_t</span> _S_heap_size;</span><br><span class="line">&#125;ï¼›</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸œè¥¿</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_S_round_up(<span class="type">size_t</span> __bytes);</span><br><span class="line">_S_freelist_index(<span class="type">size_t</span> __bytes);</span><br><span class="line">_S_refill(<span class="type">size_t</span> __n);</span><br><span class="line">_S_chunk_alloc(<span class="type">size_t</span> __size, <span class="type">int</span>&amp; __nobjs);</span><br></pre></td></tr></table></figure>

<p>å››ä¸ªå‡½æ•°ä»¥åŠè‡ªç”±é“¾è¡¨å’Œä¸‰ä¸ªæŒ‡é’ˆ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> _Obj* _S_free_list[_NFREELISTS]; </span><br><span class="line">  <span class="type">static</span> <span class="type">char</span>* _S_start_free;</span><br><span class="line">  <span class="type">static</span> <span class="type">char</span>* _S_end_free;</span><br><span class="line">  <span class="type">static</span> <span class="type">size_t</span> _S_heap_size</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±ä¼šæ¶‰åŠåˆ°è¿™å‡ ä¸ªä¸œè¥¿çš„åº”ç”¨</p>
<p>é¦–å…ˆæ˜¯å››ä¸ªå‡½æ•°å„è‡ªçš„ä½œç”¨</p>
<p>](<a target="_blank" rel="noopener" href="https://imgse.com/i/pkgVrb4">https://imgse.com/i/pkgVrb4</a>)<br><a target="_blank" rel="noopener" href="https://imgse.com/i/pkgVyVJ"><img src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://s21.ax1x.com/2024/07/01/pkgVyVJ.png" alt="pkgVyVJ.png"></a></p>
<h6 id="S-freelist-index"><a href="#S-freelist-index" class="headerlink" title="_S_freelist_index"></a>_S_freelist_index</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span>  <span class="type">size_t</span> _S_freelist_index(<span class="type">size_t</span> __bytes) &#123;</span><br><span class="line">      <span class="keyword">return</span> (((__bytes) + (<span class="type">size_t</span>)_ALIGN<span class="number">-1</span>)/(<span class="type">size_t</span>)_ALIGN - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<code>_ALIGN</code>åœ¨ä¸Šè¿°ä»£ç æœ‰å®šä¹‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;_ALIGN = <span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">enum</span> &#123;_MAX_BYTES = <span class="number">128</span>&#125;;</span><br><span class="line"><span class="keyword">enum</span> &#123;_NFREELISTS = <span class="number">16</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹è¯´æ˜å–ä¸‹æ ‡çš„ç”¨æ³•ï¼š</p>
<p>ä¾‹å¦‚è¦åˆ†é…32å­—èŠ‚çš„ç©ºé—´ï¼Œé‚£ä¹ˆè¿™é‡Œä¼ å…¥å‚æ•°32ï¼Œæ‰§è¡Œåˆ†å­è¿ç®—</p>
<p><code>((__bytes) + (size_t)_ALIGN-1</code>â€“&gt;(32 + 8 - 1) &#x3D; 39<br>åˆ†æ¯è¿ç®—<br>(size_t)_ALIGN - 1)â€“&gt;8 &#x3D; 8<br>å¾—ç»“æœä¸º:return 39&#x2F;8-1;æœ€ç»ˆè¿”å›4-1&#x3D;3ï¼Œåˆšå¥½å¯¹åº”16ç»´æ•°ç»„ä¸‹æ ‡ä¸ºä¸‰çš„ä½ç½®</p>
<h6 id="S-round-up"><a href="#S-round-up" class="headerlink" title="_S_round_up"></a>_S_round_up</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_S_round_up(size_t __bytes) </span><br><span class="line">  &#123; return (((__bytes) + (size_t) _ALIGN-1) &amp; ~((size_t) _ALIGN - 1)); &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¾‹è¯´æ˜å‘ä¸Šå–æ•´ï¼Œå¾—åˆ°8çš„æ•´æ•°å€çš„ç”¨æ³•ï¼š</p>
<p>ä¾‹å¦‚è¦åˆ†é…32å­—èŠ‚çš„ç©ºé—´ï¼Œè¿™é‡Œä¼ å…¥å‚æ•°32ï¼Œ</p>
<p>æ‰§è¡Œå‰åŠéƒ¨åˆ†çš„è¿ç®—:<code>((__bytes) + (size_t) _ALIGN-1</code>â€”&gt;(32+8-1) &#x3D; 39</p>
<p>æ‰§è¡ŒååŠéƒ¨åˆ†è¿ç®—ï¼š(size_t) _ALIGN - 1)â€”&gt;(8-1)&#x3D;7</p>
<p>ç„¶åååŠéƒ¨åˆ†å–åï¼Œå‰åæŒ‰ä½ä¸è¿ç®—ï¼Œé¦–å…ˆååŠéƒ¨åˆ†æŒ‰ä½å–å ~7 &#x3D; ~0000 0111 &#x3D; 1111 1000</p>
<p>å‰åæŒ‰ä½ä¸è¿ç®— 39 &#x3D; 32 + 4 + 2 + 1</p>
<p>â€‹    0001 0111<br>&amp; 1111 1000<br>&#x2F;â€”â€”â€”â€”â€”â€”â€“<br>â€‹    0001 0000     â€”â€”&gt; 32</p>
<p>ä¾‹å­äºŒ:ä¼ å…¥31ï¼ŒåŒä¸Šè¿°è¿ç®—ï¼Œç„¶åå¾—</p>
<p>â€‹    0001 0110</p>
<p>&amp;  1111 1000<br>&#x2F;â€”â€”â€”â€”â€”â€”â€”<br>     0001  0000     â€”â€”-&gt;32</p>
<p>æ‰€ä»¥å¾—å‡ºç»“è®ºï¼Œé€šè¿‡è¯¥å‡½æ•°å°±å¯ä»¥å‘ä¸Šå–æ•´å¾—åˆ°8çš„æ•´æ•°å€</p>
<h6 id="S-refill"><a href="#S-refill" class="headerlink" title="_S_refill"></a>_S_refill</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span>* __default_alloc_::_S_refill(<span class="type">size_t</span> __n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> __nobjs = <span class="number">20</span>;</span><br><span class="line">    <span class="type">char</span>* __chunk = _S_chunk_alloc(__n, __nobjs);</span><br><span class="line">    _Obj* __STL_VOLATILE* __my_free_list;</span><br><span class="line">    _Obj* __result;</span><br><span class="line">    _Obj* __current_obj;</span><br><span class="line">    _Obj* __next_obj;</span><br><span class="line">    <span class="type">int</span> __i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == __nobjs) <span class="keyword">return</span>(__chunk);</span><br><span class="line">	</span><br><span class="line">    __my_free_list = _S_free_list + _S_freelist_index(__n);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Build free list in chunk */</span></span><br><span class="line">      __result = (_Obj*)__chunk;</span><br><span class="line">      *__my_free_list = __next_obj = (_Obj*)(__chunk + __n);</span><br><span class="line">      <span class="keyword">for</span> (__i = <span class="number">1</span>; ; __i++) &#123;</span><br><span class="line">        __current_obj = __next_obj;</span><br><span class="line">        __next_obj = (_Obj*)((<span class="type">char</span>*)__next_obj + __n);</span><br><span class="line">        <span class="keyword">if</span> (__nobjs - <span class="number">1</span> == __i) &#123;</span><br><span class="line">            __current_obj -&gt; _M_free_list_link = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            __current_obj -&gt; _M_free_list_link = __next_obj;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">return</span>(__result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±è·Ÿä¸Šè¿°åŸç†è”ç³»èµ·æ¥äº†ï¼Œå³ä¸Šè¿°æåˆ°çš„ï¼šå¦‚æœä¸å¤Ÿï¼Œå°±ç›´æ¥ç”³è¯·20ä¸ª32å­—èŠ‚ï¼Œçœ‹è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __nobjs = <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¯¥å‡½æ•°ä¸€è¿›æ¥å°±è°ƒç”¨äº†_S_chunk_allocè¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„åˆ†æå¯ä»¥çœ‹ä¸‹é¢</p>
<p>é€šè¿‡_S_chunk_allocåˆ†é…å¥½äº†å†…å­˜ï¼Œç„¶ååœ¨è¿™é‡Œè¿›è¡Œäº†è¿™æ ·ä¸€ä¸ªæ“ä½œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__my_free_list = _S_free_list + _S_freelist_index(__n);</span><br><span class="line"></span><br><span class="line">     __result = (_Obj*)__chunk;</span><br><span class="line">     *__my_free_list = __next_obj = (_Obj*)(__chunk + __n);</span><br><span class="line">     <span class="keyword">for</span> (__i = <span class="number">1</span>; ; __i++) &#123;</span><br><span class="line">       __current_obj = __next_obj;</span><br><span class="line">       __next_obj = (_Obj*)((<span class="type">char</span>*)__next_obj + __n);</span><br><span class="line">       <span class="keyword">if</span> (__nobjs - <span class="number">1</span> == __i) &#123;</span><br><span class="line">           __current_obj -&gt; _M_free_list_link = <span class="number">0</span>;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           __current_obj -&gt; _M_free_list_link = __next_obj;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„æ“ä½œå®é™…ä¸Šæ˜¯æŠŠç”³è¯·çš„ä¸€å¤§ç‰‡è¿ç»­çš„ç©ºé—´åˆ‡åˆ†ä¸ºä¸ç´¢å¼•å¯¹åº”çš„å°å—ç„¶åç”¨è‡ªç”±é“¾è¡¨ç´¢å¼•èµ·æ¥ã€‚</p>
<p>ä»å¼€å¤´</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__my_free_list = _S_free_list + _S_freelist_index(__n);</span><br></pre></td></tr></table></figure>

<p>è·å¾—å¯¹åº”çš„ç´¢å¼•ä¸‹æ ‡ï¼Œå¾—åˆ°è‡ªç”±é“¾è¡¨çš„å¤´æŒ‡é’ˆï¼Œè¿™é‡Œè‡ªç”±é“¾è¡¨çš„ç±»å‹æ˜¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_Obj** __my_free_list;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆï¼Œè¿™é‡Œ_Objçš„å®šä¹‰ä¸º</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="title class_">_Obj</span> &#123;</span><br><span class="line">      <span class="keyword">union</span> <span class="title class_">_Obj</span>* _M_free_list_link;</span><br><span class="line">      <span class="type">char</span> _M_client_data[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>        union _Obj* _M_free_list_link;</code>å°±ç›¸å½“äºé“¾è¡¨çš„next</p>
<p>ç„¶åè¿™é‡Œçš„<code>_S_free_list</code>çš„å®šä¹‰ä¸º</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_S_free_list[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &#125;;</span><br></pre></td></tr></table></figure>

<p>å…¶å®å°±æ˜¯æ ˆé‡Œé¢çš„æ•°ç»„ï¼Œç”¨æ¥æŒ‚è‡ªç”±é“¾è¡¨çš„ï¼ˆç±»ä¼¼äºæ‹‰é“¾æ³•é‡Œé¢çš„å“ˆå¸Œè¡¨ï¼‰,ç„¶åé€šè¿‡<code>_S_free_list + _S_freelist_index(__n);</code>å°±æ‰¾åˆ°ç›¸åº”çš„ç´¢å¼•ä¸‹æ ‡çš„ä½ç½®äº†</p>
<p>ç„¶ååœ¨è¿™é‡Œå°†ç”³è¯·çš„é‚£ä¸€å¤§ç‰‡ç©ºé—´æŒ‚åœ¨å¯¹åº”çš„ä¸‹æ ‡çš„ä½ç½®</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*__my_free_list = __next_obj = (_Obj*)(__chunk + __n);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œåœ¨æœ€ååŠ äº†ä¸€ä¸ª__nï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€å—è¦åˆ†å‡ºå»ä½œä¸ºæ­¤æ¬¡å†…å­˜åˆ†é…çš„ç»“æœï¼Œç„¶åå°†å‰©ä¸‹çš„æŒ‚åœ¨S_free_listä¸‹é¢ç•™ç€å¤‡ç”¨ï¼ˆå¦‚æœä¸‹æ¬¡è¿˜è¦ç”³è¯·è¯¥å¤§å°çš„ç©ºé—´ï¼Œå°±ç›´æ¥åœ¨è¿™é‡Œå–ä¸€ä¸ªèŠ‚ç‚¹å³å¯ï¼Œä¸éœ€è¦é‡æ–°åˆ†é…äº†ï¼‰</p>
<p>å¼€å§‹åˆ‡åˆ†</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (__i = <span class="number">1</span>; ; __i++) &#123;</span><br><span class="line">        __current_obj = __next_obj;</span><br><span class="line">        __next_obj = (_Obj*)((<span class="type">char</span>*)__next_obj + __n);</span><br><span class="line">        <span class="keyword">if</span> (__nobjs - <span class="number">1</span> == __i) &#123;</span><br><span class="line">            __current_obj -&gt; _M_free_list_link = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            __current_obj -&gt; _M_free_list_link = __next_obj;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡é€šè¿‡è¿™ä¸ªæ“ä½œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__next_obj = (_Obj*)((<span class="type">char</span>*)__next_obj + __n);</span><br></pre></td></tr></table></figure>

<p>åˆ‡ä¸€å—ï¼Œç„¶åé…åˆ__current_objæ¥å°†ç”³è¯·çš„ä¸€å¤§ç‰‡å†…å­˜æ¥åˆ‡åˆ†ä¸ºå¯¹åº”å¤§å°çš„å†…å­˜å—ä½œä¸ºè‡ªç”±é“¾è¡¨çš„èŠ‚ç‚¹æŒ‚åœ¨S_free_listä¸‹é¢</p>
<p>ç„¶åè¿˜æœ‰ä¸€å¥æ²¡æœ‰åˆ†æ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">1</span> == __nobjs) <span class="keyword">return</span>(__chunk);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåªæœ‰ä¸€å—çš„è¯ä¹Ÿä¸éœ€è¦åˆ‡åˆ†äº†ï¼Œç›´æ¥åˆ†é…å°±è¡Œäº†</p>
<h6 id="S-chunk-alloc"><a href="#S-chunk-alloc" class="headerlink" title="_S_chunk_alloc"></a>_S_chunk_alloc</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">bool</span> __threads, <span class="type">int</span> __inst&gt;</span><br><span class="line"><span class="type">char</span>*</span><br><span class="line">__default_alloc_template&lt;__threads, __inst&gt;::_S_chunk_alloc(<span class="type">size_t</span> __size, </span><br><span class="line">                                                            <span class="type">int</span>&amp; __nobjs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span>* __result;</span><br><span class="line">    <span class="type">size_t</span> __total_bytes = __size * __nobjs;</span><br><span class="line">    <span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (__bytes_left &gt;= __total_bytes) &#123;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (__bytes_left &gt;= __size) &#123;</span><br><span class="line">        __nobjs = (<span class="type">int</span>)(__bytes_left/__size);</span><br><span class="line">        __total_bytes = __size * __nobjs;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">size_t</span> __bytes_to_get = </span><br><span class="line">	  <span class="number">2</span> * __total_bytes + _S_round_up(_S_heap_size &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span> (__bytes_left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list =</span><br><span class="line">                        _S_free_list + _S_freelist_index(__bytes_left);</span><br><span class="line"></span><br><span class="line">            ((_Obj*)_S_start_free) -&gt; _M_free_list_link = *__my_free_list;</span><br><span class="line">            *__my_free_list = (_Obj*)_S_start_free;</span><br><span class="line">        &#125;</span><br><span class="line">        _S_start_free = (<span class="type">char</span>*)<span class="built_in">malloc</span>(__bytes_to_get);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == _S_start_free) &#123;</span><br><span class="line">            <span class="type">size_t</span> __i;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list;</span><br><span class="line">	    _Obj* __p;</span><br><span class="line">            <span class="keyword">for</span> (__i = __size;</span><br><span class="line">                 __i &lt;= (<span class="type">size_t</span>) _MAX_BYTES;</span><br><span class="line">                 __i += (<span class="type">size_t</span>) _ALIGN) &#123;</span><br><span class="line">                __my_free_list = _S_free_list + _S_freelist_index(__i);</span><br><span class="line">                __p = *__my_free_list;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> != __p) &#123;</span><br><span class="line">                    *__my_free_list = __p -&gt; _M_free_list_link;</span><br><span class="line">                    _S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br><span class="line">                    <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	    _S_end_free = <span class="number">0</span>;	</span><br><span class="line">            _S_start_free = (<span class="type">char</span>*)malloc_alloc::<span class="built_in">allocate</span>(__bytes_to_get);</span><br><span class="line">        &#125;</span><br><span class="line">        _S_heap_size += __bytes_to_get;</span><br><span class="line">        _S_end_free = _S_start_free + __bytes_to_get;</span><br><span class="line">        <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¯”è¾ƒå¤æ‚ï¼Œä¸¾ä¾‹è¯´æ˜ï¼š</p>
<p>å¦‚æœè¦ç”³è¯·32ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œé¦–å…ˆèµ°å‡½æ•°_S_refillï¼Œè¿™é‡Œç»™</p>
<p><code>__nobjs</code>èµ‹å€¼ä¸º20ï¼Œä¼ å…¥è¯¥å‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œè¯´æ˜å‡½æ•°å†…éƒ¨å¯èƒ½ä¼šæ”¹å˜è¿™ä¸ªçš„å–å€¼</p>
<p>æ¥ä¸‹æ¥æŒ‰é¡ºåºæ‰§è¡Œä»£ç </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* __result;</span><br><span class="line"><span class="type">size_t</span> __total_bytes = __size * __nobjs;</span><br><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>__total_bytes</code>  â€“&gt; 32*20 &#x3D; 640</p>
<p>è¿™é‡Œ çš„<code>__bytes_left</code> â€”&gt;0 </p>
<p>è¿™é‡Œå‡ºç°ä¸¤ä¸ªè¾ƒä¸ºé™Œç”Ÿçš„ä¸œè¥¿ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®åœ¨äºŒçº§ç©ºé—´é…ç½®å™¨çš„ç±»å®šä¹‰ä¸­å‡ºç°è¿‡ï¼Œå¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">char</span>* _S_start_free;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* _S_end_free;</span><br><span class="line"><span class="type">static</span> <span class="type">size_t</span> _S_heap_size;</span><br></pre></td></tr></table></figure>

<p>åˆå§‹åŒ–ä¸º</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* __default_alloc_template::_S_start_free = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* __default_alloc_template::_S_end_free = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">size_t</span> __default_alloc_template::_S_heap_size = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å¯ä»¥å¾—å‡ºä¸Šè¿°çš„ç»“æœï¼Œç„¶åç»§ç»­å¾€ä¸‹èµ°ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__bytes_left &gt;= __total_bytes) &#123;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ0 &gt;&#x3D; 640å—ï¼Œä¸ç¬¦åˆ æ‰€ä»¥ä¸èµ°è¿™ä¸ªifè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (__bytes_left &gt;= __size) &#123;</span><br><span class="line">        __nobjs = (<span class="type">int</span>)(__bytes_left/__size);</span><br><span class="line">        __total_bytes = __size * __nobjs;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p>å†çœ‹è¿™ä¸ªelse ifè¯­å¥ï¼Œ0 &gt;&#x3D; 32å—ï¼Œä¹Ÿä¸ç¬¦åˆ æ‰€ä»¥èµ°æœ€åçš„elseè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">size_t</span> __bytes_to_get = </span><br><span class="line">	  <span class="number">2</span> * __total_bytes + _S_round_up(_S_heap_size &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span> (__bytes_left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list =</span><br><span class="line">                        _S_free_list + _S_freelist_index(__bytes_left);</span><br><span class="line"></span><br><span class="line">            ((_Obj*)_S_start_free) -&gt; _M_free_list_link = *__my_free_list;</span><br><span class="line">            *__my_free_list = (_Obj*)_S_start_free;</span><br><span class="line">        &#125;</span><br><span class="line">        _S_start_free = (<span class="type">char</span>*)<span class="built_in">malloc</span>(__bytes_to_get);</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == _S_start_free) &#123;</span><br><span class="line">            <span class="type">size_t</span> __i;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list;</span><br><span class="line">	    _Obj* __p;</span><br><span class="line">            <span class="keyword">for</span> (__i = __size;</span><br><span class="line">                 __i &lt;= (<span class="type">size_t</span>) _MAX_BYTES;</span><br><span class="line">                 __i += (<span class="type">size_t</span>) _ALIGN) &#123;</span><br><span class="line">                __my_free_list = _S_free_list + _S_freelist_index(__i);</span><br><span class="line">                __p = *__my_free_list;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> != __p) &#123;</span><br><span class="line">                    *__my_free_list = __p -&gt; _M_free_list_link;</span><br><span class="line">                    _S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br><span class="line">                    <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	    _S_end_free = <span class="number">0</span>;	<span class="comment">//</span></span><br><span class="line">            _S_start_free = (<span class="type">char</span>*)malloc_alloc::<span class="built_in">allocate</span>(__bytes_to_get);</span><br><span class="line">        &#125;</span><br><span class="line">        _S_heap_size += __bytes_to_get;</span><br><span class="line">        _S_end_free = _S_start_free + __bytes_to_get;</span><br><span class="line">        <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ…¢æ…¢å¾€ä¸‹åˆ†æ</p>
<p>é¦–å…ˆæäº†ä¸€ä¸ªè¿™ä¸ª</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __bytes_to_get = </span><br><span class="line">	  <span class="number">2</span> * __total_bytes + _S_round_up(_S_heap_size &gt;&gt; <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p><code>__bytes_to_get</code> &#x3D; 2 *  640 + å‘ä¸Šå–æ•´çš„8çš„æ•´æ•°å€(0 &gt;&gt; 4) çš„å…¶ç»“æœä¸º1280å­—èŠ‚</p>
<p>ç„¶åçœ‹ä¸‹é¢çš„ifåˆ¤æ–­è¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__bytes_left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list =</span><br><span class="line">                        _S_free_list + _S_freelist_index(__bytes_left);</span><br><span class="line"></span><br><span class="line">            ((_Obj*)_S_start_free) -&gt; _M_free_list_link = *__my_free_list;</span><br><span class="line">            *__my_free_list = (_Obj*)_S_start_free;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ__bytes_leftæ˜¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¸œè¥¿ï¼Œç»“æœæ˜¯0ï¼Œé‚£ä¹ˆè¿™é‡Œ 0&gt; 0å—ã€‚æ˜¾ç„¶ä¸ç¬¦åˆï¼Œæ‰€ä»¥è¿™ä¸ªifè¯­å¥è·³è¿‡ï¼Œçœ‹ä¸‹é¢çš„è¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_S_start_free = (<span class="type">char</span>*)<span class="built_in">malloc</span>(__bytes_to_get);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥åˆ†é…äº†1280å­—èŠ‚çš„å†…å­˜<br>ç„¶å</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == _S_start_free) &#123;</span><br><span class="line">            <span class="type">size_t</span> __i;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list;</span><br><span class="line">	    _Obj* __p;</span><br><span class="line">            <span class="comment">// Try to make do with what we have.  That can&#x27;t</span></span><br><span class="line">            <span class="comment">// hurt.  We do not try smaller requests, since that tends</span></span><br><span class="line">            <span class="comment">// to result in disaster on multi-process machines.</span></span><br><span class="line">            <span class="keyword">for</span> (__i = __size;</span><br><span class="line">                 __i &lt;= (<span class="type">size_t</span>) _MAX_BYTES;</span><br><span class="line">                 __i += (<span class="type">size_t</span>) _ALIGN) &#123;</span><br><span class="line">                __my_free_list = _S_free_list + _S_freelist_index(__i);</span><br><span class="line">                __p = *__my_free_list;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> != __p) &#123;</span><br><span class="line">                    *__my_free_list = __p -&gt; _M_free_list_link;</span><br><span class="line">                    _S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br><span class="line">                    <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">                    <span class="comment">// Any leftover piece will eventually make it to the</span></span><br><span class="line">                    <span class="comment">// right free list.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	    _S_end_free = <span class="number">0</span>;	<span class="comment">// In case of exception.</span></span><br><span class="line">            _S_start_free = (<span class="type">char</span>*)malloc_alloc::<span class="built_in">allocate</span>(__bytes_to_get);</span><br><span class="line">            <span class="comment">// This should either throw an</span></span><br><span class="line">            <span class="comment">// exception or remedy the situation.  Thus we assume it</span></span><br><span class="line">            <span class="comment">// succeeded.</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>mallocåˆ†é…å†…å­˜æˆåŠŸï¼Œè¿™ä¸ªifåˆ¤æ–­è¯­å¥æ˜¯ä¸ä¼šè¿›å»çš„ï¼Œå…ˆè®¨è®ºåˆ†é…å†…å­˜æˆåŠŸçš„æƒ…å†µï¼Œä¸æˆåŠŸçš„å¾…ä¼šè®¨è®º</p>
<p>ä¸èµ°ifæ¥ä¸‹æ¥èµ°ä¸‹é¢çš„è¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_S_heap_size += __bytes_to_get;</span><br><span class="line">        _S_end_free = _S_start_free + __bytes_to_get;</span><br><span class="line">        <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br></pre></td></tr></table></figure>

<p><code>_S_heap_size</code> â€“&gt; 0 + 1280 &#x3D; 1280</p>
<p><code>_S_end_free</code> â€”&gt; 0 + 1280 &#x3D; 1280</p>
<p>ç›¸å½“äºç”¨ä¸€ä¸ª<code>_S_heap_size</code>è®°å½•äº†ç”³è¯·çš„å †ç©ºé—´çš„å¤§å°ï¼Œç”¨ä¸€ä¸ª_S_start_freeå’Œ_S_end_freeå°†è¿™ç‰‡ç©ºé—´çš„é¦–ä½åœ°å€è®°å½•äº†ï¼ˆç›¸å½“äºæ¡†èµ·æ¥äº†ï¼‰</p>
<p>ç„¶åæ‰§è¡Œé€’å½’ï¼Œä¼ å…¥çš„å‚æ•°ä¾ç„¶æ˜¯ï¼ˆ32ï¼Œ20ï¼‰</p>
<p>å†æ¬¡æ‰§è¡Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* __result;</span><br><span class="line"><span class="type">size_t</span> __total_bytes = __size * __nobjs;</span><br><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ__total_bytesä»ç„¶æ˜¯640ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯__bytes_leftçš„å€¼è¿™é‡Œæ”¹å˜äº†</p>
<p><code>__bytes_left</code> â€”&gt; 1280 - 0 &#x3D; 1280</p>
<p>ç„¶åç»§ç»­å¾€ä¸‹æ‰§è¡Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__bytes_left &gt;= __total_bytes) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­è¯­å¥ 1280 &gt;&#x3D; 640å—ï¼Œè¿™æ¬¡å°±ç¬¦åˆæ¡ä»¶äº†ï¼Œä¼šæ‰§è¡Œifé‡Œé¢çš„è¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__result = _S_start_free;</span><br><span class="line">_S_start_free += __total_bytes;</span><br><span class="line"><span class="keyword">return</span>(__result);</span><br></pre></td></tr></table></figure>

<p><code>__result</code> â€”&gt; 0 ä½œä¸ºåˆ†é…å†…å­˜çš„é¦–åœ°å€è¿”å›</p>
<p><code>_S_start_free</code>â€“&gt; 0 + 640 &#x3D; 640ï¼Œè¿™é‡ŒæŠŠååŠéƒ¨åˆ†å‰©ä¸‹çš„640å­—èŠ‚æ”¾åˆ°å†…å­˜æ± é‡Œé¢äº†ï¼Œç”¨<code>_S_start_free</code>å’Œ<code>_S_end_free</code>ä¸¤ä¸ªæŒ‡é’ˆç»´æŠ¤ï¼Œè‡ªæ­¤ï¼Œ32å­—èŠ‚çš„ç©ºé—´åˆ†é…å°±ç»“æŸäº†</p>
<p>ç»“æœå°±æ˜¯è¿”å›äº†ä¸€ä¸ª640å­—èŠ‚çš„ç©ºé—´è®©refillå‡½æ•°åˆ‡åˆ†ï¼Œç„¶åå‰©ä¸‹çš„640å­—èŠ‚çš„ç©ºé—´æ”¾åœ¨å†…å­˜æ± é‡Œç”¨ä½œå¤‡ç”¨</p>
<p><strong>åˆ†é…64å­—èŠ‚çš„ç©ºé—´ï¼Œæ­¤æ—¶å†…å­˜å……è¶³</strong></p>
<p>ä¾ç„¶æ˜¯æŒ‰ä¸Šè¿°æ‰§è¡Œï¼Œåªä¸è¿‡ä¼ å…¥çš„å‚æ•°å˜ä¸ºäº†(64,20)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* __result;</span><br><span class="line"><span class="type">size_t</span> __total_bytes = __size * __nobjs;</span><br><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br></pre></td></tr></table></figure>

<p><code>__total_bytes</code> â€”&gt; 64 * 20 &#x3D; 1280</p>
<p><code>__bytes_left</code> â€”&gt; 1280 - 640 &#x3D; 640</p>
<p>ç„¶åçœ‹ä¸‹é¢çš„ifè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__bytes_left &gt;= __total_bytes) &#123;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>640 &gt;&#x3D; 1280å—ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆï¼Œè¯¥ifè¯­å¥ä¸æ‰§è¡Œ</p>
<p>ç„¶åçœ‹ä¸‹é¢çš„else ifè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (__bytes_left &gt;= __size) &#123;</span><br><span class="line">        __nobjs = (<span class="type">int</span>)(__bytes_left/__size);</span><br><span class="line">        __total_bytes = __size * __nobjs;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p>640 &gt;&#x3D;  64å—ï¼Œæ˜¾ç„¶ç¬¦åˆï¼Œæ‰€ä»¥è¿™æ¬¡çš„ç©ºé—´åˆ†é…ä¼šèµ°åˆ°è¿™ä¸ªifé‡Œé¢ï¼Œä¸‹é¢çœ‹çœ‹å¹²äº†ä»€ä¹ˆæ“ä½œ</p>
<p>é¦–å…ˆæ”¹å˜äº†<code>__nobjs</code>çš„å€¼ï¼Œä»20å˜æˆäº†640&#x2F;64 &#x3D; 10ï¼Œç„¶åå°†<code>__total_bytes</code>èµ‹å€¼ä¸º64 * 10 &#x3D; 640ï¼Œç„¶åè®©<code>__result</code>æŒ‡å‘å†…å­˜æ± ä¸­çš„é‚£640ä¸ªå­—èŠ‚ï¼Œç„¶åè¿™é‡Œè¯´æ˜å†…å­˜æ± çš„640çš„ç©ºé—´å·²ç»åˆ†é…å‡ºå»äº†ï¼Œéœ€è¦æ›´æ”¹<code>_S_start_free</code>,è¿™æ—¶<code>_S_start_free</code>å’Œ<code>__total_bytes</code>ç›¸ç­‰äº†ï¼Œè¯´æ˜å†…å­˜æ± æ²¡æœ‰ç©ºé—²å†…å­˜äº†ï¼Œç„¶åå°†åˆ†é…å‡ºé‚£640çš„ç©ºé—´è¿”å›</p>
<p>è¿™é‡Œä¿®æ”¹<code>__nobjs</code>ä¼šå½±å“åˆ°refillå‡½æ•°åˆ‡åˆ†çš„å†…å­˜å—çš„å¤§å°ï¼Œè¿™é‡Œå°±åªä¼šåˆ‡åˆ†10å¿«ï¼Œç„¶ååˆ†é…å‡ºå»ä¸€å—ï¼Œç„¶åæŒ‚9å¿«äº†</p>
<p>è‡ªæ­¤ï¼Œæœ¬æ¬¡åˆ†é…ç»“æŸ</p>
<p><strong>ç”³è¯·96å­—èŠ‚çš„å†…å­˜</strong></p>
<p>è¿™æ¬¡åˆ†é…å…¶å®è·Ÿåˆ†é…32å†…å­˜æ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œåªæ˜¯æ•°å€¼æœ‰æ‰€æ”¹å˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†èµ˜è¿°ï¼Œåªæ˜¯å°†æœ€ç»ˆçš„æ›´æ”¹çš„ç»“æœè¿›è¡Œè®¡ç®—</p>
<p><code>__total_bytes</code> â€”&gt; 20 * 96 &#x3D; 1920</p>
<p>è¿™é‡Œæœ‰æ‰€æ”¹å˜</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __bytes_to_get = </span><br><span class="line">	  <span class="number">2</span> * __total_bytes + _S_round_up(_S_heap_size &gt;&gt; <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>å› ä¸º<code>_S_heap_size</code>åœ¨åˆ†é…32å­—èŠ‚ç©ºé—´çš„æ—¶å€™è¢«æ”¹å˜äº†</p>
<p><code>__bytes_to_get</code> â€”&gt; 2 * 1920 + å‘ä¸Šå–æ•´å¾—åˆ°8çš„å€æ•°(1280 &gt;&gt; 4)  &#x3D; 3840 + 80 &#x3D; 3920</p>
<p>ç„¶åä¼šåˆ†é…3920çš„å†…å­˜åœ¨è¿™é‡Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_S_start_free = (<span class="type">char</span>*)<span class="built_in">malloc</span>(__bytes_to_get);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæœ€å</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_S_heap_size += __bytes_to_get;</span><br><span class="line">_S_end_free = _S_start_free + __bytes_to_get;</span><br></pre></td></tr></table></figure>

<p><code>_S_heap_size</code>â€“&gt; 1280 + 3920 &#x3D; 5200</p>
<p><code>_S_end_free</code> â€”&gt; 1280 + 3920 &#x3D; 5200</p>
<p>è¿›å…¥é€’å½’åå°±ä¼šè·Ÿåˆ†é…32å­—èŠ‚ä¸€æ ·ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªifè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__bytes_left &gt;= __total_bytes) &#123;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ†é…å‡º1920çš„ç©ºé—´ï¼Œç•™å‡º2000å­—èŠ‚çš„ç©ºé—´åœ¨å†…å­˜æ± ä¸­ï¼Œå› ä¸º</p>
<p><code>_S_start_free</code>â€”&gt; 1280  + 1920 &#x3D; 3200</p>
<p>&#96;&#96;_S_end_fre&#96; â€”&gt; 5200 ,æ‰€ä»¥å†…å­˜æ± æ‰€å‰©çš„ç©ºé—´å¤§å°ä¸º5200-3200 &#x3D; 2000</p>
<p>è‡ªæ­¤æœ¬æ¬¡åˆ†é…ç»“æŸ</p>
<p><strong>åˆ†é…72å­—èŠ‚ï¼Œå‡å®šæ­¤åˆ»å†…å­˜æ± è€—å°½ï¼Œå †ç©ºé—´æ²¡æœ‰å¤§äº72å­—èŠ‚çš„è¿ç»­ç©ºé—´</strong></p>
<p>è¿™é‡Œä¼ å…¥å‚æ•°(72,20)</p>
<p>ç„¶åæŒ‰ç…§æ­£å¸¸æµç¨‹</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __total_bytes = __size * __nobjs;</span><br><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°<code>__total_bytes</code> &#x3D; 72*20 &#x3D; 1440</p>
<p>å› ä¸ºå†…å­˜æ± è€—å°½äº†ï¼Œæ‰€ä»¥<code>__bytes_left</code> &#x3D; 0</p>
<p>æ‰€ä»¥å°±ä¼šè¿›å…¥elseè¯­å¥å½“ä¸­ï¼Œåˆå› ä¸ºå †ç©ºé—´å†…å·²ç»æ²¡æœ‰å¤§äº72å­—èŠ‚çš„è¿ç»­ç©ºé—´äº†ï¼Œæ‰€ä»¥ï¼Œç›´æ¥çœ‹åˆ°è¿™å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_S_start_free = (<span class="type">char</span>*)<span class="built_in">malloc</span>(__bytes_to_get);</span><br></pre></td></tr></table></figure>

<p>è¿™å¥åˆ†é…å†…å­˜å°±ä¼šå¤±è´¥ï¼Œæ‰€ä»¥å°±ä¼šè¿›å…¥ä¸‹é¢è¿™ä¸ªifè¯­å¥å½“ä¸­</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == _S_start_free) &#123;</span><br><span class="line">            <span class="type">size_t</span> __i;</span><br><span class="line">            _Obj* __STL_VOLATILE* __my_free_list;</span><br><span class="line">	    _Obj* __p;</span><br><span class="line">            <span class="keyword">for</span> (__i = __size;</span><br><span class="line">                 __i &lt;= (<span class="type">size_t</span>) _MAX_BYTES;</span><br><span class="line">                 __i += (<span class="type">size_t</span>) _ALIGN) &#123;</span><br><span class="line">                __my_free_list = _S_free_list + _S_freelist_index(__i);</span><br><span class="line">                __p = *__my_free_list;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> != __p) &#123;</span><br><span class="line">                    *__my_free_list = __p -&gt; _M_free_list_link;</span><br><span class="line">                    _S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br><span class="line">                    <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));</span><br><span class="line">.</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">	    _S_end_free = <span class="number">0</span>;	</span><br><span class="line">            _S_start_free = (<span class="type">char</span>*)malloc_alloc::<span class="built_in">allocate</span>(__bytes_to_get);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨åˆ°äº†è‡ªç”±é“¾è¡¨</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_Obj** __my_free_list;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±è¿›å…¥äº†ä¸€ä¸ªforå¾ªç¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (__i = __size;__i &lt;= (<span class="type">size_t</span>) _MAX_BYTES;__i += (<span class="type">size_t</span>) _ALIGN)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>_MAX_BYTES</code>åœ¨ä¸Šè¿°ä¹Ÿæœ‰å†™è¿‡</p>
<p>å®šä¹‰æ˜¯è¿™æ ·çš„</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;_ALIGN = <span class="number">8</span>&#125;;</span><br><span class="line"><span class="keyword">enum</span> &#123;_MAX_BYTES = <span class="number">128</span>&#125;;</span><br><span class="line"><span class="keyword">enum</span> &#123;_NFREELISTS = <span class="number">16</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ç¿»è¯‘å‡ºæ¥çš„ä»£ç å…¶å®å°±æ˜¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (__i = <span class="number">72</span>;__i &lt;= <span class="number">128</span>;__i += <span class="number">8</span> _ALIGN)</span><br></pre></td></tr></table></figure>

<p>ç„¶åçœ‹forå¾ªç¯çš„ç¬¬ä¸€å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__my_free_list = _S_free_list + _S_freelist_index(__i);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ä¼¼æ›¾ç›¸è¯†ï¼Œå› ä¸ºåœ¨refillå‡½æ•°é‡Œä¹Ÿç”¨è¿‡è¿™å¥è¯ï¼Œå«ä¹‰å°±æ˜¯ä»16ç»´æ•°ç»„çš„72è¿™ä¸ªä¸‹æ ‡çš„ä½ç½®å¼€å§‹ï¼Œä¸€ä¸ªä¸€ä¸ªçš„éå†ä»–ä»¬ä¸‹é¢æŒ‚ç€çš„è‡ªç”±é“¾è¡¨(å¦‚æœæœ‰çš„è¯)</p>
<p>å¦‚æœä»–ä»¬ä¸‹é¢æŒ‚ç€è‡ªç”±é“¾è¡¨çš„è¯ï¼Œå°±ä¼šè¿›å…¥è¿™ä¸ªifè¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">0</span> != __p) &#123;</span><br><span class="line">                    *__my_free_list = __p -&gt; _M_free_list_link;</span><br><span class="line">                    _S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br><span class="line">                    <span class="keyword">return</span>(_S_chunk_alloc(__size, __nobjs));.</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸å½“äºæ˜¯ä»è¿™ä¸ªç´¢å¼•ä¸‹é¢çš„è‡ªç”±é“¾è¡¨é‡Œæ‘˜äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_S_start_free = (<span class="type">char</span>*)__p;</span><br><span class="line">                    _S_end_free = _S_start_free + __i;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤å¥è¯å°±ç›¸å½“äºä»æ‘˜ä¸‹æ¥çš„é‚£ä¸ªèŠ‚ç‚¹åˆ†é…å‡º72+iå­—èŠ‚çš„ç©ºé—´ï¼ˆå°±æ˜¯å°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„å…¨éƒ¨ç©ºé—´ï¼‰ï¼Œç„¶åé€’å½’æ‰§è¡Œè¿™å¥è¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __bytes_left = _S_end_free - _S_start_free;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœå°±ä¸æ˜¯0äº†ï¼Œè€Œæ˜¯72ï¼Œæ‰€ä»¥å°±ä¼šæ»¡è¶³è¿™ä¸ªæ¡ä»¶åˆ¤æ–­è¯­å¥</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (__bytes_left &gt;= __size) &#123;</span><br><span class="line">        __nobjs = (<span class="type">int</span>)(__bytes_left/__size);</span><br><span class="line">        __total_bytes = __size * __nobjs;</span><br><span class="line">        __result = _S_start_free;</span><br><span class="line">        _S_start_free += __total_bytes;</span><br><span class="line">        <span class="keyword">return</span>(__result);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿™é‡Œ<code>__nobjs</code>â€“-&gt;72&#x2F;72 &#x3D; 1</p>
<p>â€‹               <code>__total_bytes </code>â€“&gt;72*1 &#x3D; 72</p>
<p>â€‹               <code>_S_start_free</code>å‘ååç§»72ä¸ªå­—èŠ‚ï¼Œç„¶åå°±å¯ä»¥å’Œ<code>_S_end_free</code>ç»´æŠ¤ä¹‹å‰é‚£ä¸ªèŠ‚ç‚¹å‰©ä¸‹çš„ç©ºé—´äº†</p>
<p>ç„¶åè¿”å›refillå‡½æ•°å°±ä¼šæ‰§è¡Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">1</span> == __nobjs) <span class="keyword">return</span>(__chunk)</span><br></pre></td></tr></table></figure>

<p>è‡ªæ­¤å†…å­˜åˆ†é…ç»“æŸ</p>
<h4 id="deallocate"><a href="#deallocate" class="headerlink" title="deallocate"></a>deallocate</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">deallocate</span><span class="params">(pointer __p, size_type __n)</span></span></span><br><span class="line"><span class="function">   </span>&#123; _Alloc::<span class="built_in">deallocate</span>(__p, __n * <span class="built_in">sizeof</span>(_Tp)); &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿæ˜¯è°ƒç”¨äº†_Allocç±»çš„deallocateå‡½æ•°ï¼Œæ‰¾ä¸€ä¸‹è¯¥å‡½æ•°çš„å®šä¹‰</p>
<h5 id="ä¸€çº§ç©ºé—´é…ç½®å™¨-1"><a href="#ä¸€çº§ç©ºé—´é…ç½®å™¨-1" class="headerlink" title="ä¸€çº§ç©ºé—´é…ç½®å™¨"></a>ä¸€çº§ç©ºé—´é…ç½®å™¨</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> malloc_alloc alloc;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ‰¾<code>malloc_alloc</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> __malloc_alloc_template&lt;<span class="number">0</span>&gt; malloc_alloc;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†æ‰¾<code>__malloc_alloc_template&lt;0&gt;</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">__malloc_alloc_template</span> &#123;</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(<span class="type">void</span>* __p, <span class="type">size_t</span> <span class="comment">/* __n */</span>)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="built_in">free</span>(__p);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åªæ˜¯è¿›è¡Œäº†free</p>
<h5 id="äºŒçº§ç©ºé—´é…ç½®å™¨-1"><a href="#äºŒçº§ç©ºé—´é…ç½®å™¨-1" class="headerlink" title="äºŒçº§ç©ºé—´é…ç½®å™¨"></a>äºŒçº§ç©ºé—´é…ç½®å™¨</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> __default_alloc_template&lt;__NODE_ALLOCATOR_THREADS, <span class="number">0</span>&gt; alloc;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰¾åˆ°å®šä¹‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">deallocate</span><span class="params">(<span class="type">void</span>* __p, <span class="type">size_t</span> __n)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (__n &gt; (<span class="type">size_t</span>) _MAX_BYTES)</span><br><span class="line">      malloc_alloc::<span class="built_in">deallocate</span>(__p, __n);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      _Obj* __STL_VOLATILE*  __my_free_list</span><br><span class="line">          = _S_free_list + _S_freelist_index(__n);</span><br><span class="line">      _Obj* __q = (_Obj*)__p;</span><br><span class="line">      _Lock __lock_instance;</span><br><span class="line"></span><br><span class="line">      __q -&gt; _M_free_list_link = *__my_free_list;</span><br><span class="line">      *__my_free_list = __q;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿™é‡Œé¦–å…ˆè¿›è¡Œäº†ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__n &gt; (<span class="type">size_t</span>) _MAX_BYTES)</span><br><span class="line">      malloc_alloc::<span class="built_in">deallocate</span>(__p, __n);</span><br></pre></td></tr></table></figure>

<p>å‡è®¾è¿™é‡Œä¼ å…¥çš„æ˜¯__n &#x3D;&#x3D; 256é‚£ä¹ˆï¼Œ256 &gt; 128å—ï¼Ÿæ˜¾ç„¶ç¬¦åˆï¼Œæ‰€ä»¥ä¼šèµ°</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">malloc_alloc::<span class="built_in">deallocate</span>(__p, __n);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå…¶å®å°±æ˜¯ä¸€çº§ç©ºé—´é…ç½®å™¨çš„å†…å­˜é‡Šæ”¾å‡½æ•°ï¼Œå°±æ˜¯æœ€åfreeäº†ä¸€ä¸‹</p>
<p>å¦‚æœä¼ å…¥çš„æ˜¯32å‘¢ï¼Œé‚£ä¹ˆå°±ä¼šèµ°else</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> _Obj**  __my_free_list = _S_free_list + _S_freelist_index(__n);</span><br><span class="line">_Obj* __q = (_Obj*)__p;</span><br><span class="line">__q -&gt; _M_free_list_link = *__my_free_list;</span><br><span class="line">*__my_free_list = __q;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰çœ‹åˆ°äº†è¿™å¥è¯</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_Obj**  __my_free_list = _S_free_list + _S_freelist_index(__n);</span><br></pre></td></tr></table></figure>

<p>è·Ÿä¸Šè¿°æ˜¯ä¸€æ ·çš„ï¼Œæ‰¾åˆ°å¯¹åº”çš„è‡ªç”±é“¾è¡¨ï¼Œç„¶åå°†è¦é‡Šæ”¾çš„__på¼ºè½¬ä¸º_Obj*ï¼Œäº¤ç»™__qä¿å­˜ï¼Œç„¶åå…¶å®å°±æ˜¯è¿›è¡Œäº†ä¸€ä¸ªå¤´æ’ï¼Œå°†è¦é‡Šæ”¾çš„è¿™å—ç©ºé—´åˆæŒ‚å›è‡ªç”±é“¾è¡¨é‡Œäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦é‡Šæ”¾128kbå†…çš„å°å†…å­˜ï¼Œå°±æŠŠè¿™äº›å°å†…å­˜é‡æ–°æŒ‚ä¼šè‡ªç”±é“¾è¡¨ï¼Œä¸ä¼šçœŸæ­£çš„é‡Šæ”¾ï¼Œè€Œæ˜¯å¯ä»¥é‡å¤åˆ©ç”¨</p>
<h4 id="construct"><a href="#construct" class="headerlink" title="construct"></a>construct</h4><p>è¿™ä¸ªä¸åˆ†ä¸€çº§é…ç½®å™¨æˆ–è€…äºŒçº§é…ç½®å™¨</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">construct</span><span class="params">(pointer __p, <span class="type">const</span> _Tp&amp; __val)</span> </span>&#123; <span class="keyword">new</span>(__p) _Tp(__val); &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨åˆ°äº†å®šä½newè¡¨è¾¾å¼</p>
<p>å®šä½newè¡¨è¾¾å¼æ¥å—æŒ‡å‘æœªæ„é€ å†…å­˜çš„æŒ‡é’ˆï¼Œå¹¶åœ¨è¯¥ç©ºé—´ä¸­åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ã€‚ä¸åˆ†é…å†…å­˜ï¼Œå®ƒåªåœ¨ç‰¹å®šçš„ï¼Œé¢„åˆ†é…çš„å†…å­˜åœ°å€æ„é€ ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<h4 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h4><p>è¿™ä¸ªä¹Ÿä¸åˆ†ä¸€çº§é…ç½®å™¨æˆ–è€…äºŒçº§é…ç½®å™¨</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">(pointer __p)</span> </span>&#123; __p-&gt;~_Tp(); &#125;</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è°ƒç”¨äº†ä¸€ä¸‹è¦é‡Šæ”¾å†…å­˜çš„é‚£ä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå®Œæˆå¯¹å¯¹è±¡çš„é‡Šæ”¾ï¼Œæ¯”è¾ƒç®€å•</p>
<p>â€‹             </p>
</article><div class="post-copyright"><div class="post-copyright__author_group"><a class="post-copyright__author_img" href="/huyue.github.io/about/"><img class="post-copyright__author_img_front" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/MiYouShe"></a><div class="post-copyright__author_name">The Yue</div><div class="post-copyright__author_desc"></div></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div id="quit-box" onclick="RemoveRewardMask()"></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">æœ¬æ–‡æ˜¯åŸåˆ›æ–‡ç« ï¼Œé‡‡ç”¨<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>åè®®ï¼Œå®Œæ•´è½¬è½½è¯·æ³¨æ˜æ¥è‡ª<a href="/huyue.github.io/">The Yue</a></span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/huyue.github.io/tags/%E7%AC%94%E8%AE%B0/"><span class="tags-punctuation"></span>ç¬”è®°<span class="tagsPageCount">16</span></a></div></div></div><nav class="needEndHide pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/huyue.github.io/2024/07/02/2024-7-2-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">é¢å‘å¯¹è±¡ç¼–ç¨‹</div></div></a></div><div class="next-post pull-right"><a href="/huyue.github.io/2024/06/28/2024-6-28-%E7%AE%97%E6%B3%95%E5%BA%93/"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ç®—æ³•åº“</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><div class="author-info__top-group"><div class="author-info__sayhi" id="author-info__sayhi" onclick="sco.changeSayHelloText()">sayhello.morning</div></div></div><div class="avatar-img-group"><img class="avatar-img" alt="å¤´åƒ" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://s21.ax1x.com/2024/04/16/pFxtXtK.png"></div><div class="author-info__description_group"><div class="author-info__description">åˆ†äº«è‡ªå·±å¯¹ç¼–ç¨‹çš„<b>çƒ­çˆ±</b>ï¼Œå¯¹ç¾å¥½ç”Ÿæ´»çš„<b>å‘å¾€</b>ï¼Œå¯¹çŸ¥è¯†æµ·æ´‹<b>æ¢ç´¢å†ç¨‹</b>ã€‚</div><div class="author-info__description2">ç›¸ä¿¡ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¯¹ä½ æœ‰ç”¨çš„çŸ¥è¯†å’Œæ•™ç¨‹ã€‚</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" target="_blank" rel="noopener" href="https://github.com/hu2271825073/huyue.github.io"><div class="author-info__name">èƒ¡è¶Š</div><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="solitude st-menu-line"></i><span>æ–‡ç« ç›®å½•</span></div><div class="toc-content" id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text">æˆå‘˜å‡½æ•°çš„é€‚é…å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mem-fn"><span class="toc-text">mem_fn</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1"><span class="toc-text">å‡½æ•°å¯¹è±¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8%EF%BC%88-%E9%87%8D%E8%A6%81-%EF%BC%89"><span class="toc-text">ç©ºé—´é…ç½®å™¨ï¼ˆ&#x3D;&#x3D;é‡è¦&#x3D;&#x3D;ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3"><span class="toc-text">å‡½æ•°æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="toc-text">æºç å‰–æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8%E2%80%94%E2%80%94allocator"><span class="toc-text">ç©ºé—´é…ç½®å™¨â€”â€”allocator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#allocate"><span class="toc-text">allocate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8"><span class="toc-text">ä¸€çº§ç©ºé—´é…ç½®å™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8"><span class="toc-text">äºŒçº§ç©ºé—´é…ç½®å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#S-freelist-index"><span class="toc-text">_S_freelist_index</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#S-round-up"><span class="toc-text">_S_round_up</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#S-refill"><span class="toc-text">_S_refill</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#S-chunk-alloc"><span class="toc-text">_S_chunk_alloc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#deallocate"><span class="toc-text">deallocate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8-1"><span class="toc-text">ä¸€çº§ç©ºé—´é…ç½®å™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%A9%BA%E9%97%B4%E9%85%8D%E7%BD%AE%E5%99%A8-1"><span class="toc-text">äºŒçº§ç©ºé—´é…ç½®å™¨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#construct"><span class="toc-text">construct</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destroy"><span class="toc-text">destroy</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="solitude st-map-line"></i><span>æœ€è¿‘å‘å¸ƒ</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/huyue.github.io/2024/07/23/%E6%9C%8D%E5%8A%A1%E7%AB%AF/" title="HTTP"><img alt="HTTP" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/Img?sort=bd_acg&amp;random=699"></a><div class="content"><a class="title" href="/huyue.github.io/2024/07/23/%E6%9C%8D%E5%8A%A1%E7%AB%AF/" title="HTTP">HTTP</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/huyue.github.io/2024/07/12/Redis%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Redisçš„åŸºæœ¬æ¦‚å¿µ"><img alt="Redisçš„åŸºæœ¬æ¦‚å¿µ" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/Img?sort=acg&amp;random=341"></a><div class="content"><a class="title" href="/huyue.github.io/2024/07/12/Redis%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Redisçš„åŸºæœ¬æ¦‚å¿µ">Redisçš„åŸºæœ¬æ¦‚å¿µ</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/huyue.github.io/2024/07/11/ReactorV3V4V5/" title="ReactorV3V4V5"><img alt="ReactorV3V4V5" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/Img?sort=acg&amp;random=985"></a><div class="content"><a class="title" href="/huyue.github.io/2024/07/11/ReactorV3V4V5/" title="ReactorV3V4V5">ReactorV3V4V5</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/huyue.github.io/2024/07/10/ReactorV2/" title="ReactorV2"><img alt="ReactorV2" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/Img?sort=acg&amp;random=799"></a><div class="content"><a class="title" href="/huyue.github.io/2024/07/10/ReactorV2/" title="ReactorV2">ReactorV2</a></div></div><div class="aside-list-item"><a class="thumbnail" href="/huyue.github.io/2024/07/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="è®¡ç®—æœºç½‘ç»œ"><img alt="è®¡ç®—æœºç½‘ç»œ" src= "/huyue.github.io/img/loading.gif" data-lazy-src="https://api.qjqq.cn/api/Img?sort=acg&amp;random=777"></a><div class="content"><a class="title" href="/huyue.github.io/2024/07/09/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</a></div></div></div></div></div></div></main><footer id="footer"><div id="st-footer-bar"><div class="footer-logo"><span class="solitude">è¶Šã®åšå®¢</span></div><div class="footer-bar-description">æ¥è‡ªThe Yue - çš„æ–‡ç« </div><a class="footer-bar-link" href="/huyue.github.io/">äº†è§£æ›´å¤š</a></div><div id="footer_deal"></div><div id="st-footer"><div class="footer-group"><h3 class="footer-title">å¯¼èˆª</h3><div class="footer-links"><a class="footer-item" href="/huyue.github.io/archives/" title="å½’æ¡£">å½’æ¡£</a><a class="footer-item" href="/huyue.github.io/categories/" title="åˆ†ç±»">åˆ†ç±»</a><a class="footer-item" href="/huyue.github.io/tags/" title="æ ‡ç­¾">æ ‡ç­¾</a></div></div><div class="footer-group"><h3 class="footer-title">æœåŠ¡</h3><div class="footer-links"><a class="footer-item" target="_blank" rel="noopener" href="https://aliyun.com/" title="é˜¿é‡Œäº‘">é˜¿é‡Œäº‘</a><a class="footer-item" target="_blank" rel="noopener" href="https://v6.51.la/" title="51laç»Ÿè®¡">51laç»Ÿè®¡</a><a class="footer-item" target="_blank" rel="noopener" href="https://tongji.baidu.com/" title="ç™¾åº¦ç»Ÿè®¡">ç™¾åº¦ç»Ÿè®¡</a></div></div><div class="footer-group"><h3 class="footer-title">æ”¯æŒ</h3><div class="footer-links"><a class="footer-item" href="/huyue.github.io/about/" title="æ‰“èµè®°å½•">æ‰“èµè®°å½•</a></div></div><div class="footer-group"><h3 class="footer-title">åè®®</h3><div class="footer-links"><a class="footer-item" href="/huyue.github.io/cookies/" title="Cookies">Cookies</a><a class="footer-item" href="/huyue.github.io/privacy/" title="ç”¨æˆ·åè®®">ç”¨æˆ·åè®®</a><a class="footer-item" href="/huyue.github.io/copyright/" title="ç‰ˆæƒåè®®">ç‰ˆæƒåè®®</a></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div class="copyright">Â© 2024 By&nbsp;<a class="footer-bar-link" href="/huyue.github.io/">èƒ¡è¶Š</a></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/hu2271825073/huyue.github.io" alt="ä¸»é¢˜">ä¸»é¢˜</a><a class="footer-bar-link cc" href="/huyue.github.io/null" aria-label="copyright"><i class="solitude st-copyright-line"></i><i class="solitude st-creative-commons-by-line"></i><i class="solitude st-creative-commons-nc-line"></i><i class="solitude st-creative-commons-nd-line"></i></a></div></div></div></footer></div><!-- right_menu--><!-- inject body--><div><script src="/huyue.github.io/js/utils.js?v=1.8.6"></script><script src="/huyue.github.io/js/main.js?v=1.8.6"></script><script src="/huyue.github.io/js/third_party/waterfall.min.js?v=1.8.6"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script src="/huyue.github.io/js/third_party/universe.min.js?v=1.8.6"></script><script>dark()
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/meting/2.0.1/Meting.min.js"></script><script>const meting_api = 'https://meting.qjqq.cn/?server=:server&type=:type&id=:id&auth=:auth&r=:r';
</script><script src="/huyue.github.io/js/music.js?v=1.8.6"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div class="js-pjax"><script async src="https://cdnjs.cloudflare.com/ajax/libs/busuanzi/2.3.0/bsz.pure.mini.min.js"></script></div></div><!-- newest comment--><!-- pjax--><script>const pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: ['title','#body-wrap','#site-config','meta[name="description"]','.js-pjax','meta[property^="og:"]','#config-diff'],
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
})

document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
})

document.addEventListener('pjax:complete', () => {
    window.refreshFn()

    document.querySelectorAll('script[data-pjax]').forEach(item => {
        const newScript = document.createElement('script')
        const content = item.text || item.textContent || item.innerHTML || ""
        Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
        newScript.appendChild(document.createTextNode(content))
        item.parentNode.replaceChild(newScript, item)
    })

    GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

})

document.addEventListener('pjax:error', (e) => {
    if (e.request.status === 404) {
        pjax.loadUrl('/404.html')
    }
})</script><!-- theme--><script>initTheme = () => {
    const cachedMode = utils.saveToLocal.get('theme');
    if (cachedMode === undefined)
        document.documentElement.setAttribute('data-theme', 'dark');
    else
        document.documentElement.setAttribute('data-theme', cachedMode);
    is_rm && rm.mode(cachedMode === undefined || cachedMode === 'dark')
}
initTheme()</script><!-- google adsense--><!-- search--><!-- music--><div class="needEndHide" id="nav-music" onclick="sco.musicToggle()"><div id="nav-music-hoverTips">éŸ³ä¹å·²æš‚åœ</div><meting-js id="584817315" server="netease" type="playlist" mutex="true" preload="none" data-lrctype="0" order="random" theme="var(--efu-main)"></meting-js></div></body></html><script>const posts=["2024/07/23/æœåŠ¡ç«¯/","2024/07/12/Redisæ•°æ®åº“/","2024/07/11/ReactorV3V4V5/","2024/07/10/ReactorV2/","2024/07/09/è®¡ç®—æœºç½‘ç»œ/","2024/07/05/2024-7-5-c++çº¿ç¨‹æ± /","2024/07/05/c++11çº¿ç¨‹åº“/","2024/07/02/2024-7-2-é¢å‘å¯¹è±¡ç¼–ç¨‹/","2024/07/01/2024-7-1-æˆå‘˜å‡½æ•°çš„é€‚é…å™¨äºç©ºé—´é…ç½®å™¨/","2024/06/28/2024-6-28-ç®—æ³•åº“/","2024/06/27/2024-6-27-STLå››/","2024/06/26/2024-6-26-STLä¸‰/","2024/06/25/2024-6-25-STLäºŒ/","2024/06/24/2024-6-24-æ ‡å‡†æ¨¡æ¿åº“/","2024/06/21/ç§»åŠ¨è¯­ä¹‰/","2024/06/21/2024-6-21-èµ„æºç®¡ç†/","2024/06/20/2024-6-20-æ¨¡æ¿/","2024/06/19/2024-6-19-javaScriptçš„å¸¸è§ç±»å‹å’Œäº‹ä»¶/","2024/06/19/2024-6-19-å¤šæ€äºŒ/","2024/06/18/2024-6-13-å¤šæ€/","2024/06/17/2024-6-17-ç»§æ‰¿/","2024/06/15/2024-6-15-å°ç»ƒä¹ ï¼šRSSè§£æ/","2024/06/15/2024-6-15-å…³è”å¼å®¹å™¨äºŒ/","2024/06/14/2024-6-14-å…³è”å¼å®¹å™¨/","2024/06/14/2024-6-14-stdstringçš„åº•å±‚å®ç°/","2024/06/14/2024-6-14-åµŒå¥—ç±»äºŒ/","2024/06/13/2024-6-13-åµŒå¥—ç±»/","2024/06/12/è¿ç®—ç¬¦é‡è½½äºŒ/","2024/06/12/è¿ç®—ç¬¦é‡è½½/","2024/06/12/æ—¥å¿—ç³»ç»Ÿçš„ä½¿ç”¨/","2024/06/08/explicitå…³é”®å­—/","2024/06/08/æ—¥å¿—ç³»ç»Ÿ/","2024/06/08/c++è¾“å…¥è¾“å‡ºæµ/","2024/06/06/leetcodesql_176 Second Highest Salary/","2024/06/04/inlineå‡½æ•°/","2024/06/04/è™šå¹»å…¥é—¨/","2024/06/04/å¼•ç”¨/","2024/06/03/newdeleteè¡¨è¾¾å¼/","2024/06/03/constå…³é”®å­—/","2024/05/25/åˆ†äº«ä¼š/","2024/05/25/sqlè¯­å¥/","2024/04/23/2024-4-23-å¸¸ç”¨shellæŒ‡ä»¤-æ–‡ä»¶ç›¸å…³/","2024/04/23/2024-4-23-å°é¡¹ç›®-è¯æ³•åˆ†æå™¨/","2024/04/23/gdbè°ƒè¯•å·¥å…·ä½¿ç”¨æ‰‹å†Œ/","2024/04/20/vimçš„ä¸€äº›å…¶ä»–æ“ä½œ/","2024/04/20/vimçš„å¸¸ç”¨å¿«æ·é”®æ€»ç»“/","2024/04/19/è™šæ‹Ÿæœºæ‰©å®¹æ–¹æ³•/","2024/04/18/é«˜çº§æ’åºç®—æ³•/","2024/04/18/å“ˆå¸Œè¡¨-ç”¨åŠ¨æ€æ•°ç»„å®ç°/","2024/04/17/å•ä¾‹æ¨¡å¼/","2024/04/17/ä¸‰ç§åŸºæœ¬æ’åºç®—æ³•çš„å®ç°/","2024/04/17/mrakdownä½¿ç”¨è¯´æ˜/"];function toRandomPost(){ pjax.loadUrl('/'+posts[Math.floor(Math.random()*posts.length)]); }</script>